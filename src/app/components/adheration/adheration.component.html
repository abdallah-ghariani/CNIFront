<div class="p-4 bg-gray-50 min-h-screen">
    <p-toast></p-toast>
    <p-confirmdialog></p-confirmdialog>
    
    <!-- Page Header -->
    <div class="mb-6 flex justify-between items-center">
        <h1 class="text-2xl font-bold text-gray-800">Membership Requests</h1>
        <button
            pButton
            icon="pi pi-refresh"
            label="Refresh"
            class="p-button-primary"
            (click)="loadRequests()"
        ></button>
    </div>
    
    <div class="card shadow-sm border-round p-4">

    <p-table 
        [value]="requests()" 
        [paginator]="true" 
        [rows]="5" 
        styleClass="p-datatable-gridlines p-datatable-sm" 
        [rowHover]="true"
        responsiveLayout="scroll"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} requests"
        [showCurrentPageReport]="true">
      <ng-template pTemplate="header">
        <tr>
          <th>#</th>
          <th>ID</th>
          <th>Status</th>
          <th>Actions</th>
          <th>Details</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-request let-i="rowIndex">
        <tr>
          <td class="text-center font-semibold">{{ i + 1 }}</td>
          <td class="font-medium">{{ request.name }}</td>
          <td>
            <span class="text-sm">{{ request.email }}</span>
          </td>
          <td>
            <span class="organisation-badge p-2 text-xs rounded-lg inline-block">
              {{ getStructureName(request.structure) }}
            </span>
          </td>
          <td>
            <span class="sector-badge p-2 text-xs rounded-lg inline-block">
              {{ getSecteurName(request.secteur) }}
            </span>
          </td>
          <td>
            <span class="status-badge px-2 py-1 text-xs font-medium rounded-full" [ngClass]="{
              'bg-blue-100 text-blue-900': request.status === 'PENDING',
              'bg-green-100 text-green-900': request.status === 'ACCEPTED',
              'bg-red-100 text-red-900': request.status === 'REFUSED'
            }">
              {{ request.status }}
            </span>
          </td>
          <td>
            <div class="flex gap-2 justify-content-start">
              <button
                pButton
                icon="pi pi-check"
                pTooltip="Accept Request"
                tooltipPosition="top"
                class="p-button-rounded p-button-success p-button-sm"
                (click)="accept(request.id)"
                [disabled]="request.status === 'ACCEPTED'"
              ></button>

              <button
                pButton
                icon="pi pi-times"
                pTooltip="Refuse Request"
                tooltipPosition="top"
                class="p-button-rounded p-button-warning p-button-sm"
                (click)="refuse(request.id)"
                [disabled]="request.status === 'REFUSED'"
              ></button>

              <button
                pButton
                icon="pi pi-trash"
                pTooltip="Delete Request"
                tooltipPosition="top"
                class="p-button-rounded p-button-danger p-button-sm"
                (click)="confirmDelete(request.id)"
              ></button>
            </div>
          </td>
          <td>
            <button pButton 
              label="View Details" 
              icon="pi pi-eye" 
              pTooltip="View Request Details"
              tooltipPosition="top"
              class="p-button-sm p-button-outlined p-button-info w-full" 
              (click)="showDetails(request)"
            ></button>
          </td>
          <td>
            <button pButton 
              label="Show Request" 
              icon="pi pi-eye" 
              class="p-button-sm p-button-text" 
              (click)="showDetails(request)">
            </button>
          </td>
        </tr>
      </ng-template>
    </p-table>

    <!-- Details Dialog -->
    <p-dialog 
      header="Request Details" 
      [(visible)]="displayDetailsDialog" 
      [modal]="true" 
      [draggable]="false" 
      [resizable]="false" 
      [style]="{width: '500px'}"
      [breakpoints]="{'960px': '75vw', '640px': '90vw'}">
      <div *ngIf="selectedRequest" class="grid p-fluid">
        <div class="col-12 md:col-6">
          <p><strong>ID:</strong> {{selectedRequest.id}}</p>
          <p><strong>Name:</strong> {{selectedRequest.name}}</p>
          <p><strong>Structure:</strong> {{selectedRequest.structure}}</p>
        </div>
        <div class="col-12 md:col-6">
          <p><strong>Secteur:</strong> {{selectedRequest.secteur}}</p>
          <p><strong>Role:</strong> {{selectedRequest.role}}</p>
          <p><strong>Status:</strong> {{selectedRequest.status}}</p>
        </div>
        <div class="col-12" *ngIf="selectedRequest.message">
          <p><strong>Message:</strong></p>
          <p class="p-3 border-round surface-100">{{selectedRequest.message}}</p>
        </div>
      </div>
      <ng-template pTemplate="footer">
        <button pButton type="button" label="Close" icon="pi pi-times" (click)="displayDetailsDialog=false"></button>
      </ng-template>
    </p-dialog>
  </div>
